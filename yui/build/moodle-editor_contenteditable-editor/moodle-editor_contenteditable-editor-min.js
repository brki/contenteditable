YUI.add("moodle-editor_contenteditable-editor",function(e,t){M.editor_contenteditable=M.editor_contenteditable||{buttonhandlers:{},menus:{},filepickeroptions:{},widgets:{},showhide_menu_handler:function(e){e.preventDefault();var t=this.getAttribute("disabled"),n=this.getAttribute("data-menu"),r=M.editor_contenteditable.menus[n];r.get("visible")||t?r.hide():r.show()},is_enabled:function(t,n){var r=e.one("#"+t+"_toolbar .contenteditable_"+n+"_button");return!r.hasAttribute("disabled")},disable_all_widgets:function(t){var n,r;for(n in M.editor_contenteditable.widgets)r=e.one("#"+t+"_toolbar .contenteditable_"+n+"_button"),r&&r.setAttribute("disabled","true")},enable_widget:function(t,n){var r=e.one("#"+t+"_toolbar .contenteditable_"+n+"_button");r&&r.removeAttribute("disabled")},enable_all_widgets:function(t){var n,r;for(n in M.editor_contenteditable.widgets)r=e.one("#"+t+"_toolbar .contenteditable_"+n+"_button"),r&&r.removeAttribute("disabled")},add_toolbar_menu:function(t,n,r,i){var s=e.one("#"+t+"_toolbar"),o=e.Node.create('<button class="contenteditable_'+n+'_button contenteditable_hasmenu" '+'data-editor="'+e.Escape.html(t)+'" '+'data-menu="'+n+"_"+t+'" >'+r+"</button>");s.append(o),M.editor_contenteditable.widgets[n]=n;var u=e.Node.create('<div class="contenteditable_'+n+"_menu"+' contenteditable_menu" data-editor="'+e.Escape.html(t)+'"></div>'),a=0,f={};for(a=0;a<i.length;a++)f=i[a],u.append(e.Node.create('<div class="contenteditable_menuentry"><a href="#" class="contenteditable_'+n+"_action_"+a+'" '+'data-editor="'+e.Escape.html(t)+'">'+f.text+"</a>"+"</div>")),M.editor_contenteditable.buttonhandlers[n+"_action_"+a]||(e.one("body").delegate("click",f.handler,".contenteditable_"+n+"_action_"+a),M.editor_contenteditable.buttonhandlers[n+"_action_"+a]=!0);M.editor_contenteditable.buttonhandlers[n]||(e.one("body").delegate("click",M.editor_contenteditable.showhide_menu_handler,".contenteditable_"+n+"_button"),M.editor_contenteditable.buttonhandlers[n]=!0);var l=new e.Overlay({bodyContent:u,visible:!1,width:"2em",align:{node:o,points:[e.WidgetPositionAlign.TL,e.WidgetPositionAlign.BL]}});M.editor_contenteditable.menus[n+"_"+t]=l,l.render()},add_toolbar_button:function(t,n,r,i){var s=e.one("#"+t+"_toolbar"),o=e.Node.create('<button class="contenteditable_'+n+'_button" data-editor="'+e.Escape.html(t)+'">'+r+"</button>");s.append(o);var u=function(e){if(M.editor_contenteditable.is_enabled(t,n))return i(e,t);e.preventDefault()};M.editor_contenteditable.buttonhandlers[n]||(e.one("body").delegate("click",u,".contenteditable_"+n+"_button"),M.editor_contenteditable.buttonhandlers[n]=!0),M.editor_contenteditable.widgets[n]=n},is_active:function(t){var n=M.editor_contenteditable.get_selection();n.length&&(n=n.pop());var r=null;return n.parentElement?r=e.one(n.parentElement()):r=e.one(n.startContainer),r&&r.ancestor("#"+t+"editable")!==null},init:function(t){var n=e.one("#"+t.elementid),r=e.Node.create('<div id="'+t.elementid+'editable" '+'contenteditable="true" '+'spellcheck="true" '+'class="editor_contenteditable"/>'),i="",s=e.Node.create('<div class="editor_contenteditable_toolbar" id="'+t.elementid+'_toolbar"/>'),o=e.io(t.content_css,{sync:!0}),u=o.responseText.indexOf("font:");u&&(i=o.responseText.substring(u+"font:".length,o.responseText.length-1),r.setStyle("font",i)),r.setStyle("min-height",1.2*(n.getAttribute("rows")-1)+"em"),r.append(n.get("value")),n.get("parentNode").insert(s,n),n.get("parentNode").insert(r,n),n.hide(),r.on("blur",function(){n.set("value",r.getHTML())}),M.editor_contenteditable.filepickeroptions[t.elementid]=t.filepickeroptions},show_filepicker:function(t,n,r){e.use("core_filepicker",function(e){var i=M.editor_contenteditable.filepickeroptions[t][n];i.formcallback=r,i.editor_target=e.one(t),M.core_filepicker.show(e,i)})},get_selection:function(){if(window.getSelection){var e=window.getSelection(),t=[],n=0;for(n=0;n<e.rangeCount;n++)t.push(e.getRangeAt(n));return t}return document.selection&&document.selection.createRange?document.selection.createRange():!1},set_selection:function(e){var t,n;if(window.getSelection){t=window.getSelection(),t.removeAllRanges();for(n=0;n<e.length;n++)t.addRange(e[n])}else document.selection&&e.select&&e.select()}}},"@VERSION@",{requires:["node","io","overlay","escape"]});
