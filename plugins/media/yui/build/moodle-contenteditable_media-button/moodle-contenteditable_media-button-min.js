YUI.add("moodle-contenteditable_media-button",function(e,t){M.contenteditable_media=M.contenteditable_media||{dialogue:null,selection:null,init:function(e){var t=function(e,t){e.preventDefault(),M.editor_contenteditable.is_active(t)||M.editor_contenteditable.focus(t),M.contenteditable_media.selection=M.editor_contenteditable.get_selection();if(M.contenteditable_media.selection!==!1){var n;M.contenteditable_media.dialogue?n=M.contenteditable_media.dialogue:n=new M.core.dialogue({visible:!1,modal:!0,close:!0,draggable:!0}),n.render(),n.set("bodyContent",M.contenteditable_media.get_form_content(t)),n.set("headerContent",M.util.get_string("createmedia","contenteditable_media")),n.show(),M.contenteditable_media.dialogue=n}};M.editor_contenteditable.add_toolbar_button(e.elementid,"media",e.icon,t,this)},open_browser:function(e){var t=this.getAttribute("data-editor");e.preventDefault(),M.editor_contenteditable.show_filepicker(t,"media",M.contenteditable_media.browser_callback)},browser_callback:function(t){console.log(t);if(t.url!==""){var n=e.one("#contenteditable_media_urlentry");n.set("value",t.url),n=e.one("#contenteditable_media_nameentry"),n.set("value",t.file)}},set_media:function(t){t.preventDefault(),M.contenteditable_media.dialogue.hide();var n=t.currentTarget.get("parentNode").one("#contenteditable_media_urlentry"),r=n.get("value");n=t.currentTarget.get("parentNode").one("#contenteditable_media_nameentry");var i=n.get("value");if(r!==""&&i!==""){M.editor_contenteditable.set_selection(M.contenteditable_media.selection);var s='<a href="'+e.Escape.html(r)+'">'+i+"</a>";document.selection&&document.selection.createRange().pasteHTML?document.selection.createRange().pasteHTML(s):document.execCommand("insertHTML",!1,s)}},get_form_content:function(t){var n=e.Node.create('<form><label for="contenteditable_media_urlentry">'+M.util.get_string("enterurl","contenteditable_media")+"</label><br/>"+'<input type="url" value="" id="contenteditable_media_urlentry" size="64"/>'+'<label for="contenteditable_media_nameentry">'+M.util.get_string("entername","contenteditable_media")+"</label><br/>"+'<input type="text" value="" id="contenteditable_media_nameentry" size="64" required="true"/>'+"<br/>"+'<button id="openmediabrowser" data-editor="'+e.Escape.html(t)+'">'+M.util.get_string("browserepositories","contenteditable_media")+"</button>"+"<hr/>"+'<button id="contenteditable_media_urlentrysubmit">'+M.util.get_string("createmedia","contenteditable_media")+"</button>"+"</form>"+"<hr/>"+M.util.get_string("accessibilityhint","contenteditable_media"));return n.one("#contenteditable_media_urlentrysubmit").on("click",M.contenteditable_media.set_media),n.one("#openmediabrowser").on("click",M.contenteditable_media.open_browser),n}}},"@VERSION@",{requires:["node","escape"]});
