YUI.add("moodle-contenteditable_image-button",function(e,t){M.contenteditable_image=M.contenteditable_image||{dialogue:null,selection:null,init:function(e){var t=function(e,t){e.preventDefault(),M.editor_contenteditable.is_active(t)||M.editor_contenteditable.focus(t),M.contenteditable_image.selection=M.editor_contenteditable.get_selection();if(M.contenteditable_image.selection!==!1){var n;M.contenteditable_image.dialogue?n=M.contenteditable_image.dialogue:n=new M.core.dialogue({visible:!1,modal:!0,close:!0,draggable:!0}),n.set("bodyContent",M.contenteditable_image.get_form_content(t)),n.set("headerContent",M.util.get_string("createimage","contenteditable_image")),n.render(),n.show(),M.contenteditable_image.dialogue=n}};M.editor_contenteditable.add_toolbar_button(e.elementid,"image",e.icon,t,this)},open_browser:function(e){var t=this.getAttribute("data-editor");e.preventDefault(),M.editor_contenteditable.show_filepicker(t,"image",M.contenteditable_image.browser_callback)},browser_callback:function(t){if(t.url!==""){var n=e.one("#contenteditable_image_urlentry");n.set("value",t.url),n=e.one("#contenteditable_image_altentry"),n.set("value",t.file)}},set_image:function(t){t.preventDefault(),M.contenteditable_image.dialogue.hide();var n=t.currentTarget.get("parentNode").one("#contenteditable_image_urlentry"),r=n.get("value");n=t.currentTarget.get("parentNode").one("#contenteditable_image_altentry");var i=n.get("value");n=t.currentTarget.get("parentNode").one("#contenteditable_image_widthentry");var s=n.get("value");n=t.currentTarget.get("parentNode").one("#contenteditable_image_heightentry");var o=n.get("value");if(r!==""&&i!==""){M.editor_contenteditable.set_selection(M.contenteditable_image.selection);var u='<img src="'+e.Escape.html(r)+'" alt="'+e.Escape.html(i)+'"';s&&(u+=' width="'+e.Escape.html(s)+'"'),o&&(u+=' height="'+e.Escape.html(o)+'"'),u+='"/>',document.selection&&document.selection.createRange().pasteHTML?document.selection.createRange().pasteHTML(u):document.execCommand("insertHTML",!1,u),document.execCommand("enableObjectResizing",!1,!0)}},get_form_content:function(t){var n=e.Node.create('<form><label for="contenteditable_image_urlentry">'+M.util.get_string("enterurl","contenteditable_image")+"</label><br/>"+'<input type="url" value="" id="contenteditable_image_urlentry" size="64"/>'+'<label for="contenteditable_image_altentry">'+M.util.get_string("enteralt","contenteditable_image")+"</label><br/>"+'<input type="text" value="" id="contenteditable_image_altentry" size="64" required="true"/>'+'<label for="contenteditable_image_widthentry">'+M.util.get_string("width","contenteditable_image")+"</label><br/>"+'<input type="text" value="" id="contenteditable_image_widthentry" size="10"/>'+"<br/>"+'<label for="contenteditable_image_heightentry">'+M.util.get_string("height","contenteditable_image")+"</label><br/>"+'<input type="text" value="" id="contenteditable_image_heightentry" size="10"/>'+"<br/>"+'<button id="openimagebrowser" data-editor="'+e.Escape.html(t)+'">'+M.util.get_string("browserepositories","contenteditable_image")+"</button>"+"<hr/>"+'<button id="contenteditable_image_urlentrysubmit">'+M.util.get_string("createimage","contenteditable_image")+"</button>"+"</form>"+"<hr/>"+M.util.get_string("accessibilityhint","contenteditable_image"));return n.one("#contenteditable_image_urlentrysubmit").on("click",M.contenteditable_image.set_image),n.one("#openimagebrowser").on("click",M.contenteditable_image.open_browser),n}}},"@VERSION@",{requires:["node","escape"]});
